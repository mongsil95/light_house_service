# 🎯 v1.2 역할별 목차 분류 기능 개발 계획

## 📋 개요
- **목표**: 입양기관, 해봄, 코디네이터 3개 역할에 맞는 맞춤형 목차 제공
- **참고 패턴**: Upwork 스타일 역할 전환 + Airbnb 스타일 뷰 분리
- **버전**: v1.2
- **예상 작업 기간**: 2주

---

## 🎨 UI/UX 설계

### 1. 상단 역할 전환 토글
```
┌──────────────────────────────────────────┐
│  [🏖️ 입양기관] [🌊 해봄] [👔 코디네이터] │
└──────────────────────────────────────────┘
```

**위치**: 페이지 상단, 검색창 위
**동작**: 클릭 시 사이드바 목차 동적 변경

### 2. 역할별 사이드바 목차

#### 🏖️ 입양기관
```
시작하기
├─ 입양 절차
├─ 참여 조건
└─ 신청 방법

활동하기
├─ 활동 매뉴얼
├─ 정화 활동
├─ 캠페인
└─ 사례 공유

관리하기
├─ 활동 보고서
└─ 기부금 납부

공통
├─ 커뮤니티
├─ 공지사항
└─ FAQ
```

#### 🌊 해봄
```
시작하기
├─ 해봄이란?
├─ 참여 방법
└─ 활동 지역 찾기

활동하기
├─ 활동 가이드
├─ 안전 수칙
├─ 정화 활동
└─ 캠페인

지원받기
├─ 지원금 신청
├─ 물품 지원
└─ 교육 프로그램

기록하기
├─ 활동 인증
└─ 후기 작성

공통
├─ 커뮤니티
├─ 공지사항
└─ FAQ
```

#### 👔 코디네이터
```
기관 관리
├─ 입양기관 현황
├─ 활동 모니터링
└─ 평가 및 피드백

해봄 관리
├─ 활동가 현황
├─ 지원금 심사
└─ 활동 조율

프로그램 운영
├─ 교육 자료
├─ 행사 기획
└─ 네트워크 구축

보고 및 분석
├─ 통합 보고서
├─ 성과 분석
└─ 개선 방안

공통
├─ 커뮤니티
├─ 공지사항
└─ FAQ
```

---

## 🛠️ 기술 구현 계획

### Phase 1: 데이터 구조 설계 (2일)

#### 1.1 역할별 카테고리 정의
```typescript
// types/roles.ts
export type UserRole = 'adopter' | 'haebom' | 'coordinator' | 'all';

export interface RoleConfig {
  id: UserRole;
  label: string;
  icon: string;
  color: string;
}

export const ROLES: RoleConfig[] = [
  { id: 'adopter', label: '입양기관', icon: '🏖️', color: 'blue' },
  { id: 'haebom', label: '해봄', icon: '🌊', color: 'green' },
  { id: 'coordinator', label: '코디네이터', icon: '👔', color: 'purple' },
];
```

#### 1.2 카테고리 데이터 구조
```typescript
// lib/categories.ts
export interface CategoryItem {
  label: string;
  value: string;
  roles?: UserRole[]; // 어떤 역할에게 보일지
  subItems?: CategoryItem[];
}

export const categoriesByRole: Record<UserRole, CategoryItem[]> = {
  adopter: [...],
  haebom: [...],
  coordinator: [...],
  all: [...], // 통합 뷰
};
```

### Phase 2: 상태 관리 (2일)

#### 2.1 역할 상태 관리
```typescript
// app/lighthouse-QnA/page.tsx

// 로컬 스토리지에 저장하여 새로고침 시에도 유지
const [currentRole, setCurrentRole] = useState<UserRole>(() => {
  if (typeof window !== 'undefined') {
    return (localStorage.getItem('userRole') as UserRole) || 'all';
  }
  return 'all';
});

useEffect(() => {
  localStorage.setItem('userRole', currentRole);
}, [currentRole]);
```

#### 2.2 URL 파라미터 연동
```typescript
// role 변경 시 URL에도 반영
const handleRoleChange = (role: UserRole) => {
  setCurrentRole(role);
  const params = new URLSearchParams(searchParams);
  if (role !== 'all') {
    params.set('role', role);
  } else {
    params.delete('role');
  }
  router.push(`/lighthouse-QnA?${params.toString()}`);
};
```

### Phase 3: UI 컴포넌트 개발 (3일)

#### 3.1 역할 전환 토글 컴포넌트
```tsx
// components/RoleToggle.tsx
interface RoleToggleProps {
  currentRole: UserRole;
  onRoleChange: (role: UserRole) => void;
}

export function RoleToggle({ currentRole, onRoleChange }: RoleToggleProps) {
  return (
    <div className="flex items-center gap-2 p-2 bg-white border border-gray-200 rounded-lg">
      {ROLES.map((role) => (
        <button
          key={role.id}
          onClick={() => onRoleChange(role.id)}
          className={cn(
            "flex items-center gap-2 px-4 py-2 rounded-md transition-colors",
            currentRole === role.id
              ? "bg-blue-500 text-white"
              : "hover:bg-gray-100 text-gray-600"
          )}
        >
          <span>{role.icon}</span>
          <span className="font-medium">{role.label}</span>
        </button>
      ))}
      <div className="h-6 w-px bg-gray-300 mx-2" />
      <button
        onClick={() => onRoleChange('all')}
        className={cn(
          "px-4 py-2 rounded-md transition-colors",
          currentRole === 'all'
            ? "bg-gray-200 text-gray-900"
            : "hover:bg-gray-100 text-gray-500"
        )}
      >
        전체보기
      </button>
    </div>
  );
}
```

#### 3.2 동적 사이드바 컴포넌트
```tsx
// components/CategorySidebar.tsx 수정
interface CategorySidebarProps {
  currentRole: UserRole;
  selectedCategory: string;
  basePath: string;
}

export default function CategorySidebar({
  currentRole,
  selectedCategory,
  basePath
}: CategorySidebarProps) {
  const categories = categoriesByRole[currentRole];
  
  return (
    <div className="sticky top-24">
      {/* 현재 역할 표시 */}
      <div className="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
        <div className="flex items-center gap-2">
          <span>{ROLES.find(r => r.id === currentRole)?.icon}</span>
          <span className="text-sm font-semibold">
            {ROLES.find(r => r.id === currentRole)?.label} 모드
          </span>
        </div>
      </div>
      
      {/* 카테고리 목록 */}
      <nav className="space-y-1">
        {categories.map((category) => (
          <CategoryGroup
            key={category.value}
            category={category}
            selectedCategory={selectedCategory}
            basePath={basePath}
          />
        ))}
      </nav>
    </div>
  );
}
```

### Phase 4: 데이터 필터링 (2일)

#### 4.1 역할별 게시물 필터링
```typescript
// 게시물에 역할 태그 추가 필요 (DB 스키마 변경)
// qna 테이블에 target_roles: string[] 컬럼 추가

const filteredQAs = qaList.filter((qa) => {
  // 카테고리 필터
  const matchesCategory = /* 기존 로직 */;
  
  // 역할 필터
  const matchesRole = currentRole === 'all' 
    || !qa.target_roles 
    || qa.target_roles.length === 0
    || qa.target_roles.includes(currentRole);
  
  return matchesCategory && matchesRole && matchesSearch;
});
```

### Phase 5: 관리자 기능 (3일)

#### 5.1 게시물 작성 시 대상 역할 선택
```tsx
// app/lighthouse-QnA/for-kwonsun/guides/page.tsx

<div>
  <label>대상 역할</label>
  <div className="flex gap-2">
    {ROLES.map((role) => (
      <label key={role.id} className="flex items-center gap-2">
        <input
          type="checkbox"
          checked={formData.target_roles?.includes(role.id)}
          onChange={(e) => {
            const roles = formData.target_roles || [];
            setFormData({
              ...formData,
              target_roles: e.target.checked
                ? [...roles, role.id]
                : roles.filter(r => r !== role.id)
            });
          }}
        />
        <span>{role.icon} {role.label}</span>
      </label>
    ))}
  </div>
</div>
```

---

## 🗃️ 데이터베이스 변경

### 1. qna 테이블 수정
```sql
-- target_roles 컬럼 추가
ALTER TABLE qna 
ADD COLUMN target_roles TEXT[] DEFAULT ARRAY[]::TEXT[];

-- 인덱스 추가 (검색 성능 향상)
CREATE INDEX idx_qna_target_roles ON qna USING GIN(target_roles);
```

### 2. resources 테이블 수정
```sql
ALTER TABLE resources 
ADD COLUMN target_roles TEXT[] DEFAULT ARRAY[]::TEXT[];

CREATE INDEX idx_resources_target_roles ON resources USING GIN(target_roles);
```

---

## 📱 반응형 고려사항

### 모바일
- 역할 전환 토글: 드롭다운으로 변경
- 사이드바: 접을 수 있는 서랍 형태

```tsx
{/* 모바일 */}
<select 
  value={currentRole} 
  onChange={(e) => onRoleChange(e.target.value as UserRole)}
  className="w-full md:hidden"
>
  {ROLES.map(role => (
    <option key={role.id} value={role.id}>
      {role.icon} {role.label}
    </option>
  ))}
  <option value="all">전체보기</option>
</select>

{/* 데스크톱 */}
<RoleToggle 
  className="hidden md:flex"
  currentRole={currentRole}
  onRoleChange={onRoleChange}
/>
```

---

## ✅ 체크리스트

### 개발
- [ ] TypeScript 타입 정의 (UserRole, CategoryItem)
- [ ] 역할별 카테고리 데이터 작성
- [ ] RoleToggle 컴포넌트 개발
- [ ] CategorySidebar 컴포넌트 수정
- [ ] 상태 관리 로직 구현
- [ ] 로컬 스토리지 연동
- [ ] URL 파라미터 연동
- [ ] 게시물 필터링 로직
- [ ] 반응형 UI 구현

### 데이터베이스
- [ ] qna 테이블 스키마 변경
- [ ] resources 테이블 스키마 변경
- [ ] 인덱스 생성
- [ ] 기존 데이터 마이그레이션

### 관리자 기능
- [ ] 게시물 작성 시 대상 역할 선택 UI
- [ ] 대상 역할 저장 로직
- [ ] 게시물 목록에 역할 표시

### 테스트
- [ ] 역할 전환 동작 테스트
- [ ] 카테고리 필터링 테스트
- [ ] 게시물 필터링 테스트
- [ ] URL 파라미터 테스트
- [ ] 로컬 스토리지 테스트
- [ ] 모바일 반응형 테스트

### 문서화
- [ ] 사용자 가이드 작성
- [ ] 관리자 매뉴얼 작성
- [ ] API 문서 업데이트

---

## 🎯 마일스톤

| 주차 | 작업 내용 | 완료 기준 |
|------|-----------|-----------|
| 1주차 | Phase 1-3 (설계, 상태관리, UI) | 역할 전환 UI 동작 |
| 2주차 | Phase 4-5 (필터링, 관리자) | 전체 기능 완성 |
| 3주차 | 테스트 및 버그 수정 | 배포 준비 완료 |

---

## 🚀 향후 확장 가능성

### v1.3+
- [ ] 사용자 프로필에 역할 저장 (로그인 기능 추가 시)
- [ ] 한 사용자가 여러 역할 동시 보유 가능
- [ ] 역할별 알림 설정
- [ ] 역할별 통계 대시보드
- [ ] 역할별 추천 콘텐츠

---

## 📚 참고 자료
- Upwork 역할 전환 UX
- Airbnb 호스트/게스트 모드
- Fiverr 구매자/판매자 전환
- 목차구성.md (현재 문서)
