# Resend ì´ë©”ì¼ ì‹œìŠ¤í…œ ë¶„ì„ ë¬¸ì„œ

## ğŸ“‹ ê°œìš”

ì´ í´ë”ëŠ” Resend ì„œë¹„ìŠ¤ë¥¼ í™œìš©í•œ ì´ë©”ì¼ ìë™í™” ì‹œìŠ¤í…œìœ¼ë¡œ, ë°˜ë ¤í•´ë³€ ìº í˜ì¸ ê´€ë ¨ ë‹¤ì–‘í•œ ì´ë©”ì¼ ì•Œë¦¼ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

---

## ğŸ“‚ í´ë” êµ¬ì¡°

```
resend-email-system/
â”œâ”€â”€ dateUtils.ts                    # ë‚ ì§œ/ì‹œê°„ í¬ë§·íŒ… ìœ í‹¸ë¦¬í‹°
â””â”€â”€ email/
    â”œâ”€â”€ types.ts                    # ì´ë©”ì¼ í˜ì´ë¡œë“œ íƒ€ì… ì •ì˜
    â”œâ”€â”€ email-resend-hook.ts        # ë©”ì¸ ì´ë©”ì¼ ì „ì†¡ ë¡œì§
    â”œâ”€â”€ notifyViaEmail.ts           # ì´ë©”ì¼ ì „ì†¡ ë˜í¼ í•¨ìˆ˜
    â”œâ”€â”€ newsletter-templates.ts     # ë‰´ìŠ¤ë ˆí„° HTML í…œí”Œë¦¿ ìƒì„±ê¸°
    â”œâ”€â”€ templates/                  # React ì´ë©”ì¼ í…œí”Œë¦¿ë“¤ (30ê°œ)
    â”œâ”€â”€ utils/                      # PDF ìƒì„± ìœ í‹¸ë¦¬í‹°
    â””â”€â”€ send-volunteer-request-*/   # API ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬
```

---

## ğŸ›  ì£¼ìš” íŒŒì¼ ìƒì„¸

### 1. `dateUtils.ts` - ë‚ ì§œ í¬ë§·íŒ… ìœ í‹¸ë¦¬í‹°

**ì£¼ìš” ê¸°ëŠ¥:**

- í•œêµ­ì–´ ë¡œì¼€ì¼ ê¸°ë°˜ ë‚ ì§œ í¬ë§·íŒ…
- MySQL TIME ë¬¸ìì—´ ì²˜ë¦¬
- ìƒëŒ€ì  ì‹œê°„ í‘œí˜„ (ì˜¤ëŠ˜, ì–´ì œ, 3ì¼ ì „ ë“±)

**í•µì‹¬ í•¨ìˆ˜:**

```typescript
formatDateOrTime(); // ìë™ íŒë‹¨ í¬ë§·íŒ…
formatKoreanDate(); // í•œêµ­ì‹ ë‚ ì§œ (2024ë…„ 5ì›” 3ì¼ (ê¸ˆ))
formatHM(); // ì‹œ:ë¶„ í˜•ì‹
formatSmartDate(); // ìƒëŒ€ì  + ì ˆëŒ€ì  ë‚ ì§œ ë°˜í™˜
```

**íƒ€ì…:**

- `SmartDate`: ìƒëŒ€ì /ì ˆëŒ€ì  ì‹œê°„ ì •ë³´ ê°ì²´
- `SmartDateFormat`: í¬ë§· ì˜µì…˜ (`'md'`, `'ymd'`, `'hm'`, `'full'`)

---

### 2. `email/types.ts` - íƒ€ì… ì •ì˜

**ì£¼ìš” í˜ì´ë¡œë“œ íƒ€ì…:**

| íƒ€ì…                     | formId                                   | ìš©ë„                    |
| ------------------------ | ---------------------------------------- | ----------------------- |
| `ApplyAdoptGroupPayload` | `apply-adopt-group`                      | ë°˜ë ¤í•´ë³€ ì…ì–‘ ì‹ ì²­      |
| `SupporterSignupPayload` | `supporter-signup`                       | ì„œí¬í„° ê°€ì…             |
| -                        | `activity-proposal`                      | ì •í™” í™œë™ ì˜ˆì•½ ì œì•ˆ     |
| -                        | `activity-general-proposal`              | ì¼ë°˜ í™œë™ ì œì•ˆ          |
| -                        | `activity-community-beachclean-proposal` | ì»¤ë®¤ë‹ˆí‹° í•´ë³€ ì •í™” ì œì•ˆ |
| -                        | `activity-network-beachclean-proposal`   | ë„¤íŠ¸ì›Œí¬ í•´ë³€ ì •í™” ì œì•ˆ |
| -                        | `activity-cityclean-atseafront-enroll`   | ë„ì‹œ ì •í™” í™œë™ ë“±ë¡     |
| -                        | `proposal-confirmed`                     | ì œì•ˆ í™•ì • (ì¼ë°˜)        |
| -                        | `proposal-confirmed-municipal`           | ì œì•ˆ í™•ì • (ì§€ìì²´)      |

**`SendEmailProps` ìœ ë‹ˆì–¸ íƒ€ì…:**

- `formId`ë¡œ ì–´ë–¤ ì´ë©”ì¼ì¸ì§€ êµ¬ë¶„
- ê° íƒ€ì…ë³„ë¡œ í•„ìˆ˜/ì„ íƒ í•„ë“œ ì •ì˜
- TypeScript íƒ€ì… ì•ˆì „ì„± ë³´ì¥

---

### 3. `email-resend-hook.ts` - ë©”ì¸ ì „ì†¡ ë¡œì§

**í•µì‹¬ í•¨ìˆ˜:**

```typescript
sendEmailNotification({
  formId,
  managerEmail,
  itaTeamEmails,
  supporterTeamEmails,
  payload,
});
```

**ê¸°ë³¸ ìˆ˜ì‹ ì ì„¤ì •:**

```typescript
DEFAULT_ITATEAM_EMAILS = [
  "itaseoul@itaseoul.org",
  "cto@itaseoul.org",
  "happything@itaseoul.org", // ìœ ê¶Œì„ 
  "sehiduo5757@itaseoul.org", // í•œìˆ˜í˜„
  "pearl.2@itaseoul.org", // ì´ì§„ì£¼
  "jjcyjh02@itaseoul.org", // ì¥ì§€í˜„
];

DEFAULT_SUPPORTER_TEAM_EMAILS = ["sehiduo5757@itaseoul.org", "gksekdnjs777@itaseoul.org"];
```

**ì§€ì›í•˜ëŠ” ì´ë©”ì¼ ì¢…ë¥˜ (formId):**

1. `apply-adopt-group` - ì…ì–‘ ì‹ ì²­ ì™„ë£Œ
2. `invite-groupmanager-enroll` - ê·¸ë£¹ë§¤ë‹ˆì € ë“±ë¡ ì´ˆëŒ€
3. `activity-proposal` - ì •í™”ì¼ì‹œ ì œì•ˆ
4. `proposal-confirmed` - ì˜ˆì•½ í™•ì • íšŒì‹ 
5. `activity-general-proposal` - ì¼ë°˜ í™œë™ ì œì•ˆ
6. `activity-community-beachclean-proposal` - ì»¤ë®¤ë‹ˆí‹° ì •í™” ì œì•ˆ
7. `activity-cityclean-atseafront-enroll` - ë„ì‹œ ì •í™” ë“±ë¡ í™•ì¸
8. `proposal-confirmed-municipal` - ì§€ìì²´ìš© ì˜ˆì•½ í™•ì •
9. `activity-network-beachclean-proposal` - ë„¤íŠ¸ì›Œí¬ ì •í™” ì œì•ˆ
10. Conference ê´€ë ¨ (Conf25) - ì°¸ê°€ì, ì‚¬ë¬´êµ­, ì½”ì—  ì•Œë¦¼
11. Newsletter, Coffee Chat ë“±

**íŠ¹ì§•:**

- Resend API ì‚¬ìš©
- ë°œì‹ ì: `"ë°˜ë ¤í•´ë³€ <info@caresea.kr>"`
- React ì»´í¬ë„ŒíŠ¸ë¥¼ ì´ë©”ì¼ í…œí”Œë¦¿ìœ¼ë¡œ ì‚¬ìš©

---

### 4. `notifyViaEmail.ts` - ë˜í¼ í•¨ìˆ˜

**ëª©ì :**

- ë„ë©”ì¸ ê´€ì ì˜ ì „ì†¡ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
- ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡œê¹… ì˜µì…˜

**ë¡œê·¸ ë ˆë²¨:**

- `silent`: ì—ëŸ¬ ë¬´ì‹œ
- `warn`: console.warn
- `error`: console.error (ê¸°ë³¸ê°’)

**ì‚¬ìš© ì˜ˆ:**

```typescript
await notifyViaEmail(args, { logLevel: "warn" });
```

---

### 5. `newsletter-templates.ts` - ë‰´ìŠ¤ë ˆí„° í…œí”Œë¦¿

**ê¸°ëŠ¥:**

- PHPì—ì„œ ì‚¬ìš©í•  HTML ë¬¸ìì—´ ìƒì„±
- ë§ˆí¬ë‹¤ìš´ ê¸°ë°˜ ë‰´ìŠ¤ë ˆí„° ë‚´ìš© ë Œë”ë§

**ì¸í„°í˜ì´ìŠ¤:**

```typescript
interface NewsletterTemplateProps {
  title: string;
  markdown: string;
  recipient: { name; organization };
  campaign: { id; title };
  viewOnlineUrl?: string;
  unsubscribeUrl?: string;
}
```

**ìŠ¤íƒ€ì¼:**

- ë°˜ì‘í˜• ë””ìì¸ (max-width: 600px)
- ê¹”ë”í•œ ì¹´ë“œ ìŠ¤íƒ€ì¼
- ë¸Œëœë“œ ì»¬ëŸ¬ (#0066cc)

---

### 6. `templates/` - ì´ë©”ì¼ í…œí”Œë¦¿ (30ê°œ)

**í…œí”Œë¦¿ ë¶„ë¥˜:**

#### ğŸ“Œ ì…ì–‘ ê´€ë ¨ (Adopt)

- `AdoptApplyConfirmationEmail` - ì…ì–‘ ì‹ ì²­ í™•ì¸
- `AdoptDonationNoticeEmail` - ê¸°ë¶€ ì•ˆë‚´
- `AdbGroupManagerEnrollEmail` - ê·¸ë£¹ë§¤ë‹ˆì € ë“±ë¡ ì´ˆëŒ€

#### ğŸ“Œ ì˜ˆì•½/í™œë™ ê´€ë ¨ (Reservation)

- `ReservationProposalEmail` - ì •í™”ì¼ì‹œ ì œì•ˆ
- `ReservationConfirmEmail` - ì˜ˆì•½ í™•ì •
- `RsvActivityJoinEmail` - í™œë™ ì°¸ê°€ í™•ì¸
- `RsvActivityJoinHostNotifyEmail` - í˜¸ìŠ¤íŠ¸ ì•Œë¦¼
- `RsvCampaignProposalEmail` - ìº í˜ì¸ ì œì•ˆ
- `RsvCampaignCityCleanUpConfirmEmail` - ë„ì‹œ ì •í™” í™•ì¸
- `RsvCommunityProposalEmail` - ì»¤ë®¤ë‹ˆí‹° ì œì•ˆ
- `RsvOfficialBeachCleanConfirmMunicipal` - ì§€ìì²´ìš© í™•ì •

#### ğŸ“Œ Conference 2025 ê´€ë ¨ (Conf25)

- `Conf25ParticipantEmail` - ì°¸ê°€ì ì•ˆë‚´
- `Conf25OfficeNotificationEmail` - ì‚¬ë¬´êµ­ ì•Œë¦¼
- `Conf25KoemNotificationEmail` - ì½”ì—  ì•Œë¦¼
- `Conf25AttendeeEmail` - ì°¸ì„ì ì•ˆë‚´
- `Conf25AttendanceOfficeEmail` - ì‚¬ë¬´êµ­ ì¶œì„ í™•ì¸
- `Conf25AttendanceKoemEmail` - ì½”ì—  ì¶œì„ í™•ì¸
- `Conf25RejectionEmail` - ì‹ ì²­ ë°˜ë ¤
- `Conf25SupplementEmail` - ë³´ì™„ ìš”ì²­
- `Conf25DailyReportEmail` - ì¼ì¼ ë¦¬í¬íŠ¸

#### ğŸ“Œ ì“°ë ˆê¸° ë°°ì¹˜ ê´€ë ¨ (Litter Placement)

- `LitterPlacementNotifyMunicipality` - ì§€ìì²´ ì•Œë¦¼
- `LitterPlacementNotifyOfficeWithPlace` - ì‚¬ë¬´êµ­ ì•Œë¦¼ (ì¥ì†Œ ìˆìŒ)
- `LitterPlacementNotifyOfficeWithoutPlace` - ì‚¬ë¬´êµ­ ì•Œë¦¼ (ì¥ì†Œ ì—†ìŒ)

#### ğŸ“Œ ê¸°íƒ€

- `NewsletterBasicEmail` - ê¸°ë³¸ ë‰´ìŠ¤ë ˆí„°
- `CoffeeChatConfirmEmail` - ì»¤í”¼ì±— í™•ì¸
- `CoffeeChatReservedEmail` - ì»¤í”¼ì±— ì˜ˆì•½
- `VolunteerInfoRequestEmail` - ìì›ë´‰ì‚¬ ì •ë³´ ë“±ë¡ ìš”ì²­
- `supporterSignupEmail` - ì„œí¬í„° ê°€ì…

**í…œí”Œë¦¿ íŠ¹ì§•:**

- `@react-email/components` ì‚¬ìš©
- ì¼ê´€ëœ ë¸Œëœë“œ ìŠ¤íƒ€ì¼
- ë¡œê³ , ì„¹ì…˜, í…Œì´ë¸” ë“± ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸
- ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ

---

### 7. `utils/` - ìœ í‹¸ë¦¬í‹°

#### `generatePDF.ts` / `generatePDFBuffer.ts`

- React ì´ë©”ì¼ í…œí”Œë¦¿ì„ PDFë¡œ ë³€í™˜
- `pdf-lib` ì‚¬ìš©
- `react-dom/server`ì˜ `renderToStaticMarkup` í™œìš©
- HTML ë¯¸í™”ë¥¼ ìœ„í•´ `js-beautify` ì‚¬ìš©

---

### 8. API ë¼ìš°íŠ¸

#### `send-volunteer-request-email/route.ts`

**ê¸°ëŠ¥:**

- ìì›ë´‰ì‚¬ í•„ìˆ˜ì •ë³´ ë“±ë¡ ìš”ì²­ ì´ë©”ì¼ ë°œì†¡ API
- POST ìš”ì²­ìœ¼ë¡œ ê°œë³„ ì´ë©”ì¼ ì „ì†¡

**ìš”ì²­ ë°”ë””:**

```typescript
{
  name: string;
  group_name: string;
  email: string;
  link: string;
}
```

**ì‘ë‹µ:**

```typescript
{ success: true, result: ResendResponse }
// ë˜ëŠ”
{ error: string, detail?: string }
```

#### `send-volunteer-request-all-email/route.ts`

- ì¼ê´„ ë°œì†¡ìš© API (ì¶”ì •)

---

## ğŸ”‘ í•µì‹¬ ì›Œí¬í”Œë¡œìš°

### ì´ë©”ì¼ ì „ì†¡ íë¦„

```mermaid
graph LR
    A[ì‚¬ìš©ì ì•¡ì…˜] --> B[notifyViaEmail]
    B --> C[sendEmailNotification]
    C --> D{formId ë¶„ê¸°}
    D --> E[í…œí”Œë¦¿ ì„ íƒ]
    E --> F[Resend API í˜¸ì¶œ]
    F --> G[ì´ë©”ì¼ ì „ì†¡]
```

1. **ì‚¬ìš©ìê°€ íŠ¹ì • ì•¡ì…˜ ìˆ˜í–‰** (ì˜ˆ: ì…ì–‘ ì‹ ì²­)
2. **`notifyViaEmail()` í˜¸ì¶œ** - ë„ë©”ì¸ ë ˆë²¨ ì¸í„°í˜ì´ìŠ¤
3. **`sendEmailNotification()` ë‚´ë¶€ í˜¸ì¶œ** - ê¸°ìˆ  ë ˆë²¨ êµ¬í˜„
4. **`formId`ë¡œ í…œí”Œë¦¿ ì„ íƒ** - switch-case ë¶„ê¸°
5. **React í…œí”Œë¦¿ ë Œë”ë§** - `@react-email/components`
6. **Resend APIë¡œ ì „ì†¡** - `resend.emails.send()`
7. **ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡œê¹…**

---

## ğŸ¯ ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€

### 1. ì…ì–‘ ì‹ ì²­ ì‹œ

```typescript
await notifyViaEmail({
  formId: "apply-adopt-group",
  managerEmail: "manager@example.com",
  itaTeamEmails: DEFAULT_ITATEAM_EMAILS,
  payload: {
    name: "í™˜ê²½ë‹¨ì²´",
    managerName: "í™ê¸¸ë™",
    // ... ê¸°íƒ€ í•„ë“œ
  },
});
```

### 2. ì •í™” í™œë™ ì œì•ˆ ì‹œ

```typescript
await notifyViaEmail({
  formId: "activity-proposal",
  managerEmail: "coordinator@example.com",
  payload: {
    title: "í•´ë³€ ì •í™” í™œë™",
    // ... ê¸°íƒ€ í•„ë“œ
  },
});
```

### 3. Conference ì°¸ê°€ì ì•Œë¦¼

```typescript
await notifyViaEmail({
  formId: "conference-participant",
  managerEmail: "participant@example.com",
  payload: {
    participantName: "ê¹€ì² ìˆ˜",
    eventDate: "2025-06-15",
    // ... ê¸°íƒ€ í•„ë“œ
  },
});
```

---

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

- **Resend**: ì´ë©”ì¼ ì „ì†¡ ì„œë¹„ìŠ¤
- **React Email**: ì´ë©”ì¼ í…œí”Œë¦¿ ì‘ì„±
- **TypeScript**: íƒ€ì… ì•ˆì „ì„±
- **date-fns**: ë‚ ì§œ í¬ë§·íŒ…
- **pdf-lib**: PDF ìƒì„±
- **react-dom/server**: ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§
- **js-beautify**: HTML í¬ë§·íŒ…

---

## ğŸ“Š í†µê³„

- **ì´ ì´ë©”ì¼ í…œí”Œë¦¿**: 30ê°œ
- **ì§€ì› formId**: 20ê°œ ì´ìƒ
- **ê¸°ë³¸ ìˆ˜ì‹ ì**: ITA íŒ€ 6ëª…, ì„œí¬í„° íŒ€ 2ëª…
- **API ë¼ìš°íŠ¸**: 2ê°œ (ê°œë³„/ì¼ê´„ ë°œì†¡)

---

## ğŸ’¡ ê°œì„  ê°€ëŠ¥ ì‚¬í•­

1. **íƒ€ì… ì•ˆì „ì„± ê°•í™”**
   - ëª¨ë“  `payload: any`ë¥¼ êµ¬ì²´ì  íƒ€ì…ìœ¼ë¡œ ë³€ê²½
   - formIdë³„ í˜ì´ë¡œë“œ íƒ€ì… ë§¤í•‘

2. **ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ **
   - ì¬ì‹œë„ ë¡œì§ ì¶”ê°€
   - Dead Letter Queue êµ¬í˜„
   - ë” ìƒì„¸í•œ ì—ëŸ¬ ë¡œê¹…

3. **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€**
   - ê° í…œí”Œë¦¿ë³„ ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸
   - ì´ë©”ì¼ ì „ì†¡ ëª¨ì˜ í…ŒìŠ¤íŠ¸

4. **ëª¨ë‹ˆí„°ë§**
   - ì´ë©”ì¼ ì „ì†¡ ì„±ê³µë¥  ì¶”ì 
   - ì‹¤íŒ¨ ì›ì¸ ë¶„ì„ ëŒ€ì‹œë³´ë“œ

5. **í…œí”Œë¦¿ ê´€ë¦¬**
   - í…œí”Œë¦¿ ë²„ì „ ê´€ë¦¬
   - A/B í…ŒìŠ¤íŠ¸ ì§€ì›
   - ë‹¤êµ­ì–´ ì§€ì›

---

## ğŸ“ ì°¸ê³ ì‚¬í•­

- ë°±ì—… íŒŒì¼ ì¡´ì¬: `__email-resend-hook copy.ts`, `_AdoptApplyConfirmationEmail copy.tsx`
- Conference 2025 ê´€ë ¨ ì´ë©”ì¼ì´ ë‹¤ìˆ˜ ì¡´ì¬ (9ê°œ)
- ì§€ìì²´(Municipal) ì „ìš© ì´ë©”ì¼ ë³„ë„ ì¡´ì¬
- ë‰´ìŠ¤ë ˆí„° ì‹œìŠ¤í…œì€ PHP ì—°ë™ì„ ê³ ë ¤í•œ ì„¤ê³„

---

## ğŸš€ ì‹œì‘í•˜ê¸°

### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
RESEND_API_KEY=your_resend_api_key
```

### ê¸°ë³¸ ì‚¬ìš©ë²•

```typescript
import { notifyViaEmail } from "@/lib/email/notifyViaEmail";

await notifyViaEmail({
  formId: "apply-adopt-group",
  managerEmail: "manager@example.com",
  payload: {
    /* ... */
  },
});
```

---

**ì‘ì„±ì¼**: 2026ë…„ 1ì›” 22ì¼  
**ë¬¸ì„œ ë²„ì „**: 1.0
